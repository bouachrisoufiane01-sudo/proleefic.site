<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proleefic Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = { theme: { extend: { colors: { morocco: { red: '#C1272D', green: '#006233' } } } } }
    </script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

    <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md text-center">
            <div class="w-16 h-16 bg-morocco-green rounded-xl mx-auto flex items-center justify-center text-white text-2xl mb-4"><i class="fa-solid fa-lock"></i></div>
            <h2 class="text-2xl font-bold mb-6">Admin Access</h2>
            <p class="text-xs text-gray-400 mb-4">Authorized Personnel Only</p>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <input type="email" id="adminEmail" placeholder="soufianebouachri0@gmail.com" class="w-full p-4 border rounded-xl font-bold" required>
                <input type="password" id="adminPass" placeholder="Password" class="w-full p-4 border rounded-xl font-bold" required>
                <button type="submit" class="w-full bg-morocco-green text-white py-4 rounded-xl font-bold hover:bg-green-700">Unlock Dashboard</button>
            </form>
        </div>
    </div>

    <div id="dashboard" class="hidden min-h-screen flex">
        <aside class="w-64 bg-gray-900 text-white p-6 hidden md:block fixed h-full">
            <h1 class="text-2xl font-black mb-10 tracking-tighter">Proleefic<span class="text-morocco-green">.</span></h1>
            <nav class="space-y-4">
                <button onclick="switchTab('blog')" class="w-full text-left p-3 hover:bg-gray-800 rounded-lg font-bold flex gap-3 items-center text-morocco-green"><i class="fa-solid fa-pen-nib"></i> Blog Manager</button>
                <button onclick="switchTab('jobs')" class="w-full text-left p-3 hover:bg-gray-800 rounded-lg font-bold flex gap-3 items-center"><i class="fa-solid fa-briefcase"></i> Post Job</button>
                <button onclick="logout()" class="w-full text-left p-3 hover:bg-red-900/50 text-red-400 rounded-lg font-bold flex gap-3 items-center mt-10"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
            </nav>
        </aside>

        <main class="flex-1 p-8 ml-0 md:ml-64 overflow-y-auto">
            
            <div id="tab-blog" class="max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Blog Manager</h2>
                    <button onclick="resetForm()" class="text-sm font-bold text-gray-500 hover:text-morocco-green"><i class="fa-solid fa-plus mr-1"></i> New Post</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="lg:col-span-2 space-y-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                            <h3 id="formTitle" class="text-xs font-bold text-gray-400 uppercase mb-4">Create New Post</h3>
                            <div class="space-y-4">
                                <input id="postTitle" type="text" placeholder="Article Title" class="w-full p-4 border-2 border-gray-200 rounded-xl font-bold text-lg focus:border-morocco-green outline-none">
                                <input id="postImage" type="text" placeholder="Image URL (Right click image -> Copy Address)" class="w-full p-3 border rounded-xl bg-gray-50 text-sm">
                                <textarea id="postBody" rows="15" placeholder="Write your content here..." class="w-full p-4 border-2 border-gray-200 rounded-xl leading-relaxed outline-none focus:border-morocco-green"></textarea>
                                
                                <div class="flex gap-3">
                                    <button id="saveBtn" onclick="savePost()" class="flex-1 bg-morocco-green text-white px-8 py-4 rounded-xl font-bold hover:bg-green-800 transition">Publish Article</button>
                                    <button id="cancelBtn" onclick="resetForm()" class="hidden px-6 py-4 rounded-xl font-bold bg-gray-100 hover:bg-gray-200 text-gray-600">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 sticky top-4">
                            <h3 class="text-xs font-bold text-gray-400 uppercase mb-4">Existing Posts</h3>
                            <div id="adminPostList" class="space-y-3 max-h-[80vh] overflow-y-auto pr-2">
                                <div class="text-center py-10 text-gray-400"><i class="fa-solid fa-spinner fa-spin"></i> Loading...</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div id="tab-jobs" class="hidden max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold mb-6">Post Manual Job</h2>
                <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4 grid grid-cols-2 gap-4">
                    <input id="jobTitle" type="text" placeholder="Job Title" class="col-span-2 w-full p-3 border rounded-xl font-bold">
                    <input id="jobCompany" type="text" placeholder="Company Name" class="w-full p-3 border rounded-xl">
                    <select id="jobCity" class="w-full p-3 border rounded-xl"><option>Tanger</option><option>Casablanca</option><option>Rabat</option><option>Agadir</option><option>Marrakech</option></select>
                    <input id="jobSalary" type="text" placeholder="Salary (e.g. 4000 DH)" class="w-full p-3 border rounded-xl">
                    <input id="jobEmail" type="text" placeholder="Email for CV" class="w-full p-3 border rounded-xl">
                    <select id="jobCat" class="col-span-2 w-full p-3 border rounded-xl"><option value="cat_prod">Production</option><option value="cat_tech">Technician</option><option value="cat_sales">Sales</option><option value="cat_admin">Admin</option></select>
                    <textarea id="jobDesc" rows="5" placeholder="Job Description" class="col-span-2 w-full p-3 border rounded-xl"></textarea>
                    <button onclick="saveJob()" class="col-span-2 bg-blue-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-blue-800">Post Job</button>
                </div>
            </div>

        </main>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyBsPi64Eb0GQnGjcxg6n6YRFbG-iO9K_pM", authDomain: "proleefic-85800.firebaseapp.com", projectId: "proleefic-85800", storageBucket: "proleefic-85800.firebasestorage.app", messagingSenderId: "1033605555868", appId: "1:1033605555868:web:577ff42f0bcfb0b6122f59", measurementId: "G-WJ4XKS01P0" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const ADMIN_EMAIL = "soufianebouachri0@gmail.com"; 
        let currentEditId = null; // Stores ID if we are editing

        // 1. LOGIN
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const pass = document.getElementById('adminPass').value;
            auth.signInWithEmailAndPassword(email, pass).then(cred => {
                if(cred.user.email.toLowerCase() !== ADMIN_EMAIL.toLowerCase()) {
                    alert("Access Denied."); auth.signOut();
                } else {
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    loadPostsList(); // LOAD POSTS ON LOGIN
                }
            }).catch(err => alert("Login Failed: " + err.message));
        }

        // 2. LOAD POSTS LIST (REALTIME)
        function loadPostsList() {
            db.collection("posts").orderBy("date", "desc").onSnapshot(snap => {
                const list = document.getElementById('adminPostList');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const p = doc.data();
                    const div = document.createElement('div');
                    div.className = "p-3 rounded-lg border border-gray-100 hover:bg-gray-50 flex gap-3 items-center group transition";
                    div.innerHTML = `
                        <img src="${p.image || ''}" class="w-10 h-10 rounded bg-gray-200 object-cover">
                        <div class="flex-1 min-w-0">
                            <h4 class="font-bold text-sm truncate">${p.title}</h4>
                            <p class="text-[10px] text-gray-400 truncate">${p.body}</p>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="editPost('${doc.id}')" class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition flex items-center justify-center"><i class="fa-solid fa-pen text-xs"></i></button>
                            <button onclick="deletePost('${doc.id}')" class="w-8 h-8 rounded-full bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition flex items-center justify-center"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    `;
                    list.appendChild(div);
                });
            });
        }

        // 3. EDIT MODE TRIGGER
        function editPost(id) {
            db.collection("posts").doc(id).get().then(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('postTitle').value = data.title;
                    document.getElementById('postImage').value = data.image;
                    document.getElementById('postBody').value = data.body;
                    
                    // UI Changes
                    currentEditId = id;
                    document.getElementById('saveBtn').innerText = "Update Post";
                    document.getElementById('saveBtn').classList.remove('bg-morocco-green');
                    document.getElementById('saveBtn').classList.add('bg-blue-600');
                    document.getElementById('formTitle').innerText = "Editing: " + data.title;
                    document.getElementById('cancelBtn').classList.remove('hidden');
                }
            });
        }

        // 4. RESET FORM
        function resetForm() {
            currentEditId = null;
            document.getElementById('postTitle').value = "";
            document.getElementById('postImage').value = "";
            document.getElementById('postBody').value = "";
            
            // UI Reset
            document.getElementById('saveBtn').innerText = "Publish Article";
            document.getElementById('saveBtn').classList.add('bg-morocco-green');
            document.getElementById('saveBtn').classList.remove('bg-blue-600');
            document.getElementById('formTitle').innerText = "Create New Post";
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        // 5. SAVE OR UPDATE
        function savePost() {
            const title = document.getElementById('postTitle').value;
            const body = document.getElementById('postBody').value;
            const img = document.getElementById('postImage').value || "https://images.unsplash.com/photo-1586281380349-632531db7ed4";

            if(!title || !body) return alert("Please fill in title and body.");

            const postData = {
                title: title,
                body: body,
                image: img,
                date: firebase.firestore.FieldValue.serverTimestamp() // Updates date to now
            };

            if (currentEditId) {
                // UPDATE EXISTING
                db.collection("posts").doc(currentEditId).update(postData).then(() => {
                    alert("Post Updated Successfully!");
                    resetForm();
                });
            } else {
                // CREATE NEW
                db.collection("posts").add({ ...postData, author: "Admin" }).then(() => {
                    alert("Post Published!");
                    resetForm();
                });
            }
        }

        // 6. DELETE POST
        function deletePost(id) {
            if(confirm("Are you sure you want to delete this post?")) {
                db.collection("posts").doc(id).delete().then(() => alert("Deleted!"));
            }
        }

        function switchTab(tab) {
            document.getElementById('tab-blog').classList.add('hidden');
            document.getElementById('tab-jobs').classList.add('hidden');
            document.getElementById('tab-'+tab).classList.remove('hidden');
        }
        function logout() { auth.signOut().then(() => location.reload()); }
        
        // SAVE MANUAL JOB
        function saveJob() {
            db.collection("jobs").add({
                id: "m" + Date.now(),
                title: document.getElementById('jobTitle').value,
                company: document.getElementById('jobCompany').value,
                location: document.getElementById('jobCity').value,
                salary: document.getElementById('jobSalary').value,
                desc: document.getElementById('jobDesc').value,
                email: document.getElementById('jobEmail').value,
                catId: document.getElementById('jobCat').value,
                isDirect: true, isReal: true, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => alert("Job Posted!"));
        }
    </script>
</body>
</html>
